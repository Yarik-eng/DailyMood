{% extends "base.html" %}

{% block title %}Про нас — DailyMood{% endblock %}

{% block extra_head %}
<style>
  .feedback-input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
    font-size: 1rem;
    transition: all 0.18s ease;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.3);
  }
  
  .feedback-input:focus {
    outline: none;
    border-color: rgba(99,102,241,0.6);
    box-shadow: 0 0 0 4px rgba(99,102,241,0.12), inset 0 2px 6px rgba(0,0,0,0.3);
    background: rgba(255,255,255,0.08);
  }
  
  .feedback-input::placeholder {
    color: rgba(255,255,255,0.4);
  }
  
  html.dark .feedback-input {
    background: rgba(2,6,23,0.6);
    border-color: rgba(79,172,254,0.15);
    color: #e6eef8;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.6);
  }
  
  html:not(.dark) .feedback-input {
    background: rgba(255,255,255,0.95);
    border-color: rgba(2,6,23,0.12);
    color: #0f172a;
    box-shadow: inset 0 1px 2px rgba(2,6,23,0.1);
  }
  
  html:not(.dark) .feedback-input::placeholder {
    color: rgba(15,23,42,0.4);
  }
  
  .feedback-select {
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
    font-size: 1rem;
    transition: all 0.18s ease;
    cursor: pointer;
  }
  
  html.dark .feedback-select {
    background: rgba(2,6,23,0.6);
    border-color: rgba(79,172,254,0.15);
    color: #e6eef8;
  }
  
  html:not(.dark) .feedback-select {
    background: rgba(255,255,255,0.95);
    border-color: rgba(2,6,23,0.12);
    color: #0f172a;
  }
  
  html:not(.dark) .feedback-select option {
    background: #ffffff;
    color: #0f172a;
  }
</style>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-6 py-16">
  <section class="theme-panel card p-8">
    <h1 class="text-3xl font-extrabold text-gray-900 mb-4 dark:text-gray-100" data-i18n="about_title">Про нас</h1>
    <p class="text-gray-700 mb-6 dark:text-gray-300" data-i18n="about_description">DailyMood — простий інструмент для відстеження настрою й звичок. Ми допомагаємо помічати закономірності та підтримувати щоденну рефлексію за допомогою зручного інтерфейсу та ненав'язливих нагадувань.</p>

    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4 dark:text-gray-100" data-i18n="about_mission_title">Наша місія</h2>
    <p class="text-gray-600 mb-4 dark:text-gray-300" data-i18n="about_mission_text">Сприяти психологічній стійкості через щоденні дрібні кроки: від запису настрою до формування корисних звичок. Ми віримо, що усвідомлене ставлення до свого емоційного стану — це шлях до кращого розуміння себе та гармонійного життя.</p>

    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4 dark:text-gray-100" data-i18n="about_features_title">Основні можливості</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white/5 p-5 rounded-lg">
        <h3 class="font-semibold mb-2 dark:text-gray-100" data-i18n="about_feature_mood_tracking_title">Відстеження настрою</h3>
        <p class="text-gray-600 dark:text-gray-300" data-i18n="about_feature_mood_tracking_desc">Зручний щоденник для запису вашого емоційного стану, активностей та думок. Візуалізація змін настрою допомагає краще розуміти себе.</p>
      </div>
      <div class="bg-white/5 p-5 rounded-lg">
        <h3 class="font-semibold mb-2 dark:text-gray-100" data-i18n="about_feature_stats_title">Статистика та аналіз</h3>
        <p class="text-gray-600 dark:text-gray-300" data-i18n="about_feature_stats_desc">Детальні графіки та звіти допомагають відслідковувати тенденції вашого настрою та знаходити фактори, які впливають на ваше самопочуття.</p>
      </div>
      <div class="bg-white/5 p-5 rounded-lg">
        <h3 class="font-semibold mb-2 dark:text-gray-100" data-i18n="about_feature_quotes_title">Щоденні цитати</h3>
        <p class="text-gray-600 dark:text-gray-300" data-i18n="about_feature_quotes_desc">Колекція надихаючих цитат, які допомагають знайти мотивацію та підтримку. Можливість зберігати улюблені цитати у власній колекції.</p>
      </div>
      <div class="bg-white/5 p-5 rounded-lg">
        <h3 class="font-semibold mb-2 dark:text-gray-100" data-i18n="about_feature_habits_title">Відстеження звичок</h3>
        <p class="text-gray-600 dark:text-gray-300" data-i18n="about_feature_habits_desc">Інструменти для формування та підтримки корисних звичок. Відмічайте свій прогрес та отримуйте візуальне підтвердження своїх досягнень.</p>
      </div>
    </div>

    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4 dark:text-gray-100" data-i18n="about_special_title">Особливості проєкту</h2>
    <ul class="list-disc list-inside space-y-3 text-gray-600 dark:text-gray-300 mb-8">
      <li data-i18n="about_special_list_ux">Зручний та інтуїтивно зрозумілий інтерфейс</li>
      <li data-i18n="about_special_list_theme">Підтримка світлої та темної тем оформлення</li>
      <li data-i18n="about_special_list_privacy">Захист приватності — ваші дані зберігаються локально</li>
      <li data-i18n="about_special_list_no_ads">Немає нав'язливої реклами чи прихованих платежів</li>
      <li data-i18n="about_special_list_updates">Постійне оновлення та покращення функціоналу</li>
    </ul>

    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4 dark:text-gray-100" data-i18n="about_roadmap_title">Плани розвитку</h2>
    <p class="text-gray-600 mb-4 dark:text-gray-300" data-i18n="about_roadmap_intro">Ми постійно працюємо над вдосконаленням DailyMood. У майбутньому плануємо додати:</p>
    <ul class="list-disc list-inside space-y-3 text-gray-600 dark:text-gray-300 mb-8">
      <li data-i18n="about_roadmap_list_analytics">Розширену аналітику настрою та звичок</li>
      <li data-i18n="about_roadmap_list_export">Можливість експорту даних у різні формати</li>
      <li data-i18n="about_roadmap_list_calendar">Інтеграцію з календарем</li>
      <li data-i18n="about_roadmap_list_new_categories">Нові категорії активностей та метрик</li>
    </ul>

    <h2 class="text-xl font-semibold text-gray-900 mt-8 mb-4 dark:text-gray-100" data-i18n="about_contact_title">Контакти та зворотний зв'язок</h2>
    <p class="text-gray-600 mb-2 dark:text-gray-300" data-i18n="about_contact_p1">Проєкт розробляється як освітній/демонстраційний — для зворотного зв'язку або внесків див. репозиторій на GitHub.</p>
    <p class="text-gray-600 dark:text-gray-300" data-i18n="about_contact_p2">Ми завжди раді отримати ваші пропозиції щодо покращення проєкту чи нових функцій. Якщо у вас є ідеї або ви знайшли помилку, будь ласка, створіть issue в нашому репозиторії.</p>
  </section>

  <section class="theme-panel card p-8" id="feedback-section" style="margin-top:16px;">
    <h2 class="text-xl font-semibold text-gray-900 mb-4 dark:text-gray-100" data-i18n="feedback_title">Зворотний зв'язок</h2>
    <form id="feedbackForm" class="add-form" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <input type="text" id="fbName" class="feedback-input" placeholder="Ім'я (необов'язково)" data-i18n="feedback_name">
      <input type="email" id="fbEmail" class="feedback-input" placeholder="Email (необов'язково)" data-i18n="feedback_email">
      <textarea id="fbMessage" class="feedback-input" rows="4" placeholder="Ваш відгук..." data-i18n="feedback_message" style="grid-column:1/-1"></textarea>
      <select id="fbRating" class="feedback-select" aria-label="Rating" style="max-width:180px;">
        <option value="" data-i18n="feedback_rating_none">Без оцінки</option>
        <option value="1">1 ⭐</option>
        <option value="2">2 ⭐⭐</option>
        <option value="3">3 ⭐⭐⭐</option>
        <option value="4">4 ⭐⭐⭐⭐</option>
        <option value="5">5 ⭐⭐⭐⭐⭐</option>
      </select>
      <button type="submit" class="btn" style="max-width:220px;" data-i18n="feedback_send">Надіслати відгук</button>
    </form>
    <div id="feedbackResult" class="muted" style="margin-top:10px; display:none;"></div>
  </section>

  <section class="theme-panel card p-8" id="recent-feedback" style="margin-top:16px;">
    <h2 class="text-xl font-semibold text-gray-900 mb-4 dark:text-gray-100" data-i18n="recent_feedback_title">Останні відгуки</h2>
    <div id="feedbackList" class="space-y-3" aria-live="polite"></div>
  </section>
</div>
<script>
  (function(){
    function t(key){ try { return (typeof currentLanguage!=='undefined' && currentLanguage==='uk') ? (translations_uk[key]||'') : (translations_en[key]||''); } catch(e){ return ''; } }
    const form = document.getElementById('feedbackForm'); if (!form) return;
    const result = document.getElementById('feedbackResult');
    const listWrap = document.getElementById('feedbackList');

    function formatDate(iso){ try { const d=new Date(iso); return d.toLocaleString(); } catch(e){ return iso; } }
    function truncate(s, n){ if(!s) return ''; return s.length>n ? s.slice(0,n-1)+'…' : s; }

    async function loadRecent(){
      try{
        const r = await fetch('/api/feedback');
        if(!r.ok) throw new Error('Bad status');
        const data = await r.json();
        const items = (Array.isArray(data)?data:[]).slice(0,10);
        if(items.length===0){
          listWrap.innerHTML = `<div class="muted">${t('no_feedback_yet') || 'Ще немає відгуків'}</div>`;
          return;
        }
        listWrap.innerHTML = items.map(f=>{
          const id = f.id ?? '';
          const rating = (f.rating!=null && f.rating!=="")? ` • ${t('feedback_rating')||'Оцінка'}: ${f.rating}` : '';
          const ts = f.created_at ? ` • ${formatDate(f.created_at)}` : '';
          const meta = `#${id}${rating}${ts}`;
          return `<div class="journal-entry" style="text-align:left;">
            <div style="font-weight:700; font-size:0.95rem; opacity:0.85;">${meta}</div>
            <div style="margin-top:6px;">${truncate(f.message||'', 180)}</div>
          </div>`;
        }).join('');
      }catch(err){
        console.error('loadRecent feedback failed', err);
        listWrap.innerHTML = `<div class="muted">${t('feedback_error') || 'Помилка при завантаженні'}</div>`;
      }
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const payload = {
        name: document.getElementById('fbName').value,
        email: document.getElementById('fbEmail').value,
        message: document.getElementById('fbMessage').value,
        rating: document.getElementById('fbRating').value || null
      };
      try{
        const r = await fetch('/api/feedback', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        if (r.ok){
          result.style.display='block'; result.textContent = t('feedback_thanks') || 'Дякуємо за відгук!';
          form.reset();
          loadRecent();
        } else {
          const data = await r.json().catch(()=>({}));
          result.style.display='block'; result.textContent = data.message || (t('feedback_error') || 'Помилка при відправці');
        }
      } catch(err){
        console.error('feedback error', err);
        result.style.display='block'; result.textContent = t('feedback_error') || 'Помилка при відправці';
      }
    });

    // Initial load and on language change
    loadRecent();
  window.addEventListener('languageChanged', loadRecent);
  })();
</script>
{% endblock %}